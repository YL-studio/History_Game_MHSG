# 生成可直接运行的 EXE 程序

## 概览

本项目支持生成 Windows EXE 程序，用户无需安装任何依赖即可直接运行。

---

## 三种 EXE 生成方式

### 方式 1️⃣  NSIS 安装程序（推荐用于分发）

**特点：**
- ✅ 用户体验最佳（专业的安装向导）
- ✅ 自动创建快捷方式
- ✅ 支持卸载功能
- ✅ 文件关联注册
- ✅ 文件大小最小（~50-80MB）

**生成方法：**
```bash
npm run build-win-installer
```

**生成的文件：**
- `dist/国史科举·五经通考 Setup 1.0.0.exe` - 完整安装程序

**用户使用：**
1. 双击 .exe 文件
2. 按照安装向导完成安装
3. 安装后自动创建桌面快捷方式
4. 双击快捷方式或从开始菜单运行


### 方式 2️⃣  便携版 EXE（推荐用于 USB、网盘）

**特点：**
- ✅ 无需安装，直接运行
- ✅ 可复制到 USB、网盘、移动设备
- ✅ 不修改系统注册表
- ✅ 自包含所有依赖
- ✅ 文件大小较大（~150-200MB）

**生成方法：**
```bash
npm run build-win-portable
```

**生成的文件：**
- `dist/国史科举·五经通考 1.0.0.exe` - 便携版程序

**用户使用：**
1. 复制 .exe 文件到任意位置
2. 直接双击运行
3. 无需安装，无需 Node.js


### 方式 3️⃣  同时生成两个版本

**特点：**
- ✅ 用户可选择安装或便携版本

**生成方法：**
```bash
npm run build-win
```

**生成的文件：**
- `dist/国史科举·五经通考 Setup 1.0.0.exe` - 安装程序
- `dist/国史科举·五经通考 1.0.0.exe` - 便携版


---

## 完整步骤（从零开始构建 EXE）

### 第 1 步：准备环境

```bash
# 安装 Node.js (如果未安装)
# 从 https://nodejs.org/ 下载 LTS 版本

# 验证 Node.js 已安装
node --version
npm --version
```

### 第 2 步：安装项目依赖

```bash
cd /Users/zzj/Desktop/Historygame
npm install
```

### 第 3 步：构建 EXE

```bash
# 推荐：生成安装程序
npm run build-win-installer

# 或生成便携版
npm run build-win-portable

# 或两个都生成
npm run build-win
```

### 第 4 步：找到生成的 EXE

生成的 EXE 文件在：
```
dist/
├── 国史科举·五经通考 Setup 1.0.0.exe    # 安装程序
├── 国史科举·五经通考 1.0.0.exe          # 便携版
└── ...其他文件
```

### 第 5 步：分享给他人

将 EXE 文件上传到：
- 网盘（百度网盘、阿里云盘等）
- 邮件附件
- 文件服务器
- USB 设备

他人可以直接运行，无需安装任何东西！


---

## 自动化构建脚本

### 使用快速构建脚本

**Windows:**
```bash
# 双击 build.bat
# 或在命令行运行：
build.bat win
```

**macOS/Linux:**
```bash
chmod +x build.sh
./build.sh win
```

这些脚本会自动：
1. 检查 Node.js
2. 安装/更新依赖
3. 清理旧构建
4. 构建 EXE
5. 显示输出位置


---

## 增强功能：自动化安装脚本

对于最终用户，项目包含以下自动化脚本：

### `run.bat` - 批处理启动脚本
```bash
run.bat
```

**功能：**
- ✅ 自动检测 Node.js 是否已安装
- ✅ 如果 node_modules 不存在，自动运行 `npm install`
- ✅ 自动启动应用
- ✅ 用户友好的错误提示

### `run.ps1` - PowerShell 启动脚本
```powershell
powershell -ExecutionPolicy Bypass -File run.ps1
```

**功能：**
- ✅ 彩色输出，视觉效果更好
- ✅ 更详细的诊断信息
- ✅ 更强大的错误处理

### `start.bat` - 简化启动脚本
```bash
start.bat
```

**功能：**
- ✅ 快速启动应用
- ✅ 自动安装依赖


---

## EXE 文件大小说明

| 类型 | 大小 | 原因 |
|------|------|------|
| 安装程序 | 50-80 MB | 包含压缩的应用文件 |
| 便携版 | 150-200 MB | 包含完整的 Node.js 和所有依赖 |

大文件大小是正常的，因为 Electron 本身需要整个 Chromium 浏览器引擎。


---

## 常见问题

### Q1: 用户说"无法找到 Node.js"怎么办？

**A:** 用户应该：
1. 运行 `run.bat` 或 `start.bat`（自动检测和安装）
2. 或者手动从 https://nodejs.org/ 安装 Node.js
3. 重启计算机后重试

### Q2: EXE 文件很大怎么办？

**A:** 这是正常的。Electron 应用本身就很大（包含浏览器引擎）。
- 安装程序使用压缩，所以文件较小
- 便携版解压后会更大
- 可以使用 7-Zip 等工具压缩分享

### Q3: 如何减小 EXE 大小？

**A:** 目前很难减小。可以考虑：
1. 使用便携版（实际上没有更小）
2. 压缩后分享
3. 告诉用户这是正常的

### Q4: 生成 EXE 时出错怎么办？

**A:** 检查：
1. `npm install` 是否成功完成
2. Node.js 版本是否 >= 12.0
3. 是否有足够的磁盘空间
4. Windows 是否安装了 Visual C++ Build Tools

### Q5: 如何为 EXE 添加自定义图标？

**A:** 
1. 创建 `assets/` 文件夹
2. 放入 `icon.ico` 文件（256x256 或更大）
3. 重新运行构建脚本


---

## 最佳实践

### 对于开发者：

✅ 定期测试 EXE 生成  
✅ 在干净的 Windows 系统上测试 EXE  
✅ 在生成前更新版本号  
✅ 保留生成脚本和代码以供日后更新  

### 对于最终用户分发：

✅ 提供安装程序版本（更专业）  
✅ 在网盘上备份便携版（方便传播）  
✅ 提供使用说明（运行方式、系统要求）  
✅ 测试 EXE 在实际 Windows 系统上的运行  

### 安全考虑：

✅ 从官方渠道分发 EXE  
✅ 考虑对 EXE 进行代码签名（可选）  
✅ 定期更新应用以修复安全漏洞  
✅ 告知用户应用来源和功能  


---

## 下一步

### 立即生成 EXE

```bash
npm run build-win-installer
```

### 快速测试生成的 EXE

1. 在干净的 Windows VM 上测试
2. 确保能正常安装和运行
3. 检查快捷方式是否创建成功
4. 测试数据保存功能


---

**现在您已经拥有可以分享给任何 Windows 用户的独立 EXE 程序！** 🎉

无需他们安装 Node.js，无需运行命令行，只需双击 EXE 即可！
